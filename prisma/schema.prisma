generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model DocCategory {
  id          Int           @id @default(autoincrement())
  name        String        @db.VarChar(100)
  slug        String        @unique @db.VarChar(100)
  description String?       @db.Text
  parentId    Int?          @map("parent_id")
  icon        String        @default("file-text") @db.VarChar(50)
  sortOrder   Int           @default(0) @map("sort_order")
  isVisible   Boolean       @default(true) @map("is_visible")
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")

  parent      DocCategory?  @relation("CategoryTree", fields: [parentId], references: [id], onDelete: SetNull)
  children    DocCategory[] @relation("CategoryTree")
  documents   Document[]

  @@map("doc_categories")
}

model Document {
  id          Int          @id @default(autoincrement())
  title       String       @db.VarChar(255)
  slug        String       @unique @db.VarChar(255)
  content     String       @db.LongText
  excerpt     String?      @db.Text
  status      DocStatus    @default(draft)
  categoryId  Int?         @map("category_id")
  isPinned    Boolean      @default(false) @map("is_pinned")
  sortOrder   Int          @default(0) @map("sort_order")
  viewCount   Int          @default(0) @map("view_count")
  author      String       @default("admin") @db.VarChar(100)
  publishedAt DateTime?    @map("published_at")
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")

  category    DocCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  @@index([status], map: "idx_status")
  @@index([categoryId], map: "idx_category")
  @@index([publishedAt], map: "idx_published")
  @@fulltext([title, content], map: "idx_search")
  @@map("documents")
}

enum DocStatus {
  draft
  published
  archived
}
